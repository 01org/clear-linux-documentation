<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Identity Service &mdash; ClearLinux Documentation 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ClearLinux Documentation 1.0.1 documentation" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="openstack-identity">
<span id="identity-service"></span><h1>Identity Service<a class="headerlink" href="#openstack-identity" title="Permalink to this headline">¶</a></h1>
<p>The OpenStack Identity service provides a single point of integration for
managing authentication, authorization, and service catalog services.
Additionally, it provides information about users but that are not included in
OpenStack (such as LDAP services) can be integrated into a pre-existing
infrastructure.</p>
<p>When installing OpenStack Identity service, you must register each
service in your OpenStack installation. Identity service can then track
which OpenStack services are installed and where they are located on
the network.</p>
<div class="section" id="install-and-configure">
<h2>Install and configure<a class="headerlink" href="#install-and-configure" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to install and configure the OpenStack
Identity service, code-named keystone, on the controller node. For
performance, this configuration deploys the Nginx* HTTP server to handle
requests.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>Before you configure the OpenStack Identity service, you must create a
database and an administration token.</p>
<ol class="arabic">
<li><p class="first">To create the database, complete the following actions:</p>
<ul>
<li><p class="first">Use the database access client to connect to the database server as the
<code class="docutils literal"><span class="pre">root</span></code> user.:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mysql -u root -p
</pre></div>
</div>
</li>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">keystone</span></code> database.:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE DATABASE keystone;
</pre></div>
</div>
</li>
<li><p class="first">Grant proper access to the <code class="docutils literal"><span class="pre">keystone</span></code> databaseReplace <code class="docutils literal"><span class="pre">KEYSTONE_DBPASS</span></code>
with a suitable password.:</p>
<div class="highlight-python"><div class="highlight"><pre>GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;
GRANT ALL PRIVILEGES ON keystone.* TO &#39;keystone&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;KEYSTONE_DBPASS&#39;;
</pre></div>
</div>
</li>
<li><p class="first">Exit the database access client.</p>
</li>
</ul>
</li>
<li><p class="first">Generate a random value to use as the administration token during
initial configuration:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openssl rand -hex 10
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="install-and-configure-components">
<h3>Install and configure components<a class="headerlink" href="#install-and-configure-components" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Run the following command to install the packages.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># swupd bundle-add openstack-identity</span>
<span class="c"># swupd verify --fix</span>
</pre></div>
</div>
</li>
<li><p class="first">Custom configurations will be located at <code class="docutils literal"><span class="pre">/etc/keystone/</span></code>.</p>
<ul>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">/etc/keystone</span></code> directory.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># mkdir /etc/keystone</span>
</pre></div>
</div>
</li>
<li><p class="first">Create keystone configuration file <code class="docutils literal"><span class="pre">/etc/keystone/keystone.conf</span></code>.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># touch /etc/keystone/keystone.conf</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Edit the <code class="docutils literal"><span class="pre">/etc/keystone/keystone.conf</span></code> file and complete the following
actions:</p>
<ul>
<li><p class="first">In the <code class="docutils literal"><span class="pre">[DEFAULT]</span></code> section, define the value of the initial
administration token. Replace <code class="docutils literal"><span class="pre">ADMIN_TOKEN</span></code> with the random value that
you generated in a previous step.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">admin_token</span> <span class="o">=</span> <span class="n">ADMIN_TOKEN</span>
</pre></div>
</div>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">[database]</span></code> section, configure database access. Replace
<code class="docutils literal"><span class="pre">KEYSTONE_DBPASS</span></code> with the password you chose for the database.:</p>
<div class="highlight-python"><div class="highlight"><pre>[database]
...
connection = mysql://keystone:KEYSTONE_DBPASS@controller/keystone
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Ensure files have proper ownership by running the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># systemctl restart update-triggers.target</span>
</pre></div>
</div>
</li>
<li><p class="first">Populate the Identity service database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="finalize-the-installation">
<h3>Finalize the installation<a class="headerlink" href="#finalize-the-installation" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Keystone is deployed as a uwsgi module. To start the Identity
service, you should enable and start the nginx service.:</p>
<div class="highlight-python"><div class="highlight"><pre># systemctl enable nginx uwsgi@keystone-admin.socket \
 uwsgi@keystone-public.socket

# systemctl start nginx uwsgi@keystone-admin.socket \
 uwsgi@keystone-public.socket
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="create-the-service-entity-and-api-endpoints">
<h2>Create the service entity and API endpoints<a class="headerlink" href="#create-the-service-entity-and-api-endpoints" title="Permalink to this headline">¶</a></h2>
<p>The Identity service provides a catalog of services and their locations.
Each service that you add to your OpenStack environment requires a
service entity and several API endpoints in the catalog.</p>
<div class="section" id="id1">
<h3>Prerequisites<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>You must pass the value of the authentication token to the <cite>openstack</cite>
command with the <code class="docutils literal"><span class="pre">--os-token</span></code> parameter or set the OS_TOKEN
environment variable. Similarly, you must also pass the value of the
Identity service URL to the <cite>openstack</cite> command with the <code class="docutils literal"><span class="pre">--os-url</span></code>
parameter or set the OS_URL environment variable. This guide uses
environment variables to reduce command length.</p>
<ol class="arabic">
<li><p class="first">Configure the authentication token:</p>
<div class="highlight-python"><div class="highlight"><pre>$ export OS_TOKEN=ADMIN_TOKEN
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">ADMIN_TOKEN</span></code> with the authentication token that you
generated before. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ export OS_TOKEN=294a4c8a8a475f9b9836
</pre></div>
</div>
</li>
<li><p class="first">Configure the endpoint URL:</p>
<div class="highlight-python"><div class="highlight"><pre>$ export OS_URL=http://controller:35357/v3
</pre></div>
</div>
</li>
<li><p class="first">Configure the Identity API version:</p>
<div class="highlight-python"><div class="highlight"><pre>$ export OS_IDENTITY_API_VERSION=3
</pre></div>
</div>
</li>
<li><p class="first">Install the OpenStack Python clients bundle:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># swupd bundle-add openstack-python-clients</span>
<span class="c"># swupd verify --fix</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id2">
<h3>Create the service entity and API endpoints<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">The Identity service manages a catalog of services in your OpenStack
environment. Services use this catalog to determine the other services
available in your environment.</p>
<p>Create the service entity for the Identity service:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack service create \
  --name keystone --description &quot;OpenStack Identity&quot; identity
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Identity               |
| enabled     | True                             |
| id          | 4ddaae90388b4ebc9d252ec2252d8d10 |
| name        | keystone                         |
| type        | identity                         |
+-------------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">The Identity service manages a catalog of API endpoints associated with
the services in your OpenStack environment. Services use this catalog to
determine how to communicate with other services in your environment.</p>
<p>OpenStack uses three API endpoint variants for each service: admin,
internal, and public. The admin API endpoint allows modifying users and
tenants by default, while the public and internal APIs do not allow these
operations. In a production environment, the variants might reside on
separate networks that service different types of users for security
reasons. For instance, the public API network might be visible from the
Internet so customers can manage their clouds. The admin API network
might be restricted to operators within the organization that manages
cloud infrastructure. The internal API network might be restricted to
the hosts that contain OpenStack services. Also, OpenStack supports
multiple regions for scalability. For simplicity, this guide uses the
management network for all endpoint variations and the default
<code class="docutils literal"><span class="pre">RegionOne</span></code> region.</p>
<p>Create the Identity service API endpoints:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack endpoint create --region RegionOne \
  identity public http://controller:5000/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 30fff543e7dc4b7d9a0fb13791b78bf4 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c8c0927262a45ad9066cfe70d46892c |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:5000/v3        |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  identity internal http://controller:5000/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 57cfa543e7dc4b712c0ab137911bc4fe |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 6f8de927262ac12f6066cfe70d99ac51 |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:5000/v3        |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  identity admin http://controller:35357/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 78c3dfa3e7dc44c98ab1b1379122ecb1 |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 34ab3d27262ac449cba6cfe704dbc11f |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:35357/v3       |
+--------------+----------------------------------+
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="creating-projects-users-and-roles">
<h2>Creating projects, users and roles<a class="headerlink" href="#creating-projects-users-and-roles" title="Permalink to this headline">¶</a></h2>
<p>Complete the following steps to create projects, users and roles:</p>
<ol class="arabic">
<li><p class="first">Create an administrative project, user, and role for administrative
operations in your environment:</p>
<ul>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">admin</span></code> project:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack project create --domain default \
  --description &quot;Admin Project&quot; admin
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Admin Project                    |
| domain_id   | default                          |
| enabled     | True                             |
| id          | 343d245e850143a096806dfaefa9afdc |
| is_domain   | False                            |
| name        | admin                            |
| parent_id   | None                             |
+-------------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">admin</span></code> user:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack user create --domain default \
  --password-prompt admin
User Password:
Repeat User Password:
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | default                          |
| email     | admin@example.com                |
| enabled   | True                             |
| id        | ac3377633149401296f6c0d92d79dc16 |
| name      | admin                            |
+-----------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">admin</span></code> role:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack role create admin
+-------+----------------------------------+
| Field | Value                            |
+-------+----------------------------------+
| id    | cd2cb9a39e874ea69e5d4b896eb16128 |
| name  | admin                            |
+-------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Add the <code class="docutils literal"><span class="pre">admin</span></code> role to the <code class="docutils literal"><span class="pre">admin</span></code> project and user:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack role add --project admin --user admin admin
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">This guide uses a service project that contains a unique user for each
service that you add to your environment. Create the <code class="docutils literal"><span class="pre">service</span></code>
project:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack project create --domain default \
  --description &quot;Service Project&quot; service
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Service Project                  |
| domain_id   | default                          |
| enabled     | True                             |
| id          | 894cdfa366d34e9d835d3de01e752262 |
| is_domain   | False                            |
| name        | service                          |
| parent_id   | None                             |
+-------------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Regular (non-admin) tasks should use an unprivileged project and user.
As an example, this guide creates the <code class="docutils literal"><span class="pre">demo</span></code> project and user.</p>
<ul>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">demo</span></code> project:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack project create --domain default \
  --description &quot;Demo Project&quot; demo
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Demo Project                     |
| domain_id   | default                          |
| enabled     | True                             |
| id          | ed0b60bf607743088218b0a533d5943f |
| is_domain   | False                            |
| name        | demo                             |
| parent_id   | None                             |
+-------------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">demo</span></code> user:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack user create --domain default \
  --password-prompt demo
User Password:
Repeat User Password:
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | default                          |
| email     | demo@example.com                 |
| enabled   | True                             |
| id        | 58126687cbcc4888bfa9ab73a2256f27 |
| name      | demo                             |
+-----------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">user</span></code> role:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack role create user
+-------+----------------------------------+
| Field | Value                            |
+-------+----------------------------------+
| id    | 997ce8d05fc143ac97d83fdfb5998552 |
| name  | user                             |
+-------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Add the <code class="docutils literal"><span class="pre">user</span></code> role to the <code class="docutils literal"><span class="pre">demo</span></code> project and user:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack role add --project demo --user demo user
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="verify-operation">
<h2>Verify operation<a class="headerlink" href="#verify-operation" title="Permalink to this headline">¶</a></h2>
<p>Verify operation of the Identity service before installing other
services.</p>
<ol class="arabic">
<li><p class="first">For security reasons, remove admin_token from
<code class="docutils literal"><span class="pre">/etc/keystone/keystone.conf</span></code>:</p>
<p>Edit the <code class="docutils literal"><span class="pre">[DEFAULT]</span></code> section and remove <code class="docutils literal"><span class="pre">admin_token</span></code>.</p>
</li>
<li><p class="first">Restart the keystone-admin service to reload the changes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># systemctl restart uwsgi@keystone-admin.service</span>
</pre></div>
</div>
</li>
<li><p class="first">Unset the temporary <code class="docutils literal"><span class="pre">OS_TOKEN</span></code> and <code class="docutils literal"><span class="pre">OS_URL</span></code> environment variables:</p>
<div class="highlight-python"><div class="highlight"><pre>$ unset OS_TOKEN OS_URL
</pre></div>
</div>
</li>
<li><p class="first">As the <code class="docutils literal"><span class="pre">admin</span></code> user, request an authentication token:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack --os-auth-url http://controller:35357/v3 \
  --os-project-domain-id default --os-user-domain-id default \
  --os-project-name admin --os-username admin --os-auth-type password \
  token issue
Password:
+------------+----------------------------------+
| Field      | Value                            |
+------------+----------------------------------+
| expires    | 2015-03-24T18:55:01Z             |
| id         | ff5ed908984c4a4190f584d826d75fed |
| project_id | cf12a15c5ea84b019aec3dc45580896b |
| user_id    | 4d411f2291f34941b30eef9bd797505a |
+------------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">As the <code class="docutils literal"><span class="pre">demo</span></code> user, request an authentication token:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack --os-auth-url http://controller:5000/v3 \
  --os-project-domain-id default --os-user-domain-id default \
  --os-project-name demo --os-username demo --os-auth-type password \
  token issue
Password:
+------------+----------------------------------+
| Field      | Value                            |
+------------+----------------------------------+
| expires    | 2014-10-10T12:51:33Z             |
| id         | 1b87ceae9e08411ba4a16e4dada04802 |
| project_id | 4aa51bb942be4dd0ac0555d7591f80a6 |
| user_id    | 7004dfa0dda84d63aef81cf7f100af01 |
+------------+----------------------------------+
</pre></div>
</div>
</li>
</ol>
<p>Next topic: <a class="reference internal" href="openstack_identity-openrc.html#openstack-identity-openrc"><span>Create OpenStack* client environment scripts</span></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Identity Service</a><ul>
<li><a class="reference internal" href="#install-and-configure">Install and configure</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#install-and-configure-components">Install and configure components</a></li>
<li><a class="reference internal" href="#finalize-the-installation">Finalize the installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-the-service-entity-and-api-endpoints">Create the service entity and API endpoints</a><ul>
<li><a class="reference internal" href="#id1">Prerequisites</a></li>
<li><a class="reference internal" href="#id2">Create the service entity and API endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-projects-users-and-roles">Creating projects, users and roles</a></li>
<li><a class="reference internal" href="#verify-operation">Verify operation</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/openstack_identity.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Intel OTC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/openstack_identity.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>