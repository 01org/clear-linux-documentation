<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Image Service &mdash; ClearLinux Documentation 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ClearLinux Documentation 1.0.1 documentation" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="image-service">
<span id="openstack-image"></span><h1>Image Service<a class="headerlink" href="#image-service" title="Permalink to this headline">¶</a></h1>
<p>The OpenStack Image service (glance) enables users to discover, register, and
retrieve virtual machine images.</p>
<div class="section" id="install-and-configure-the-image-service">
<h2>Install and configure the Image Service<a class="headerlink" href="#install-and-configure-the-image-service" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to install and configure the Image service,
code-named glance, on the controller node. For simplicity, this configuration
stores images on the local file system. By default, this directory is
<code class="docutils literal"><span class="pre">/var/lib/glance/images/</span></code>.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>Before you install and configure the Image service, you must create a database,
service credentials, and API endpoints.</p>
<ol class="arabic">
<li><p class="first">To create the database, complete these steps:</p>
<ul>
<li><p class="first">Use the database access client to connect to the database
server as the <code class="docutils literal"><span class="pre">root</span></code> user.:</p>
<div class="highlight-python"><div class="highlight"><pre>$ mysql -u root -p
</pre></div>
</div>
</li>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">glance</span></code> database:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE DATABASE glance;
</pre></div>
</div>
</li>
<li><p class="first">Grant proper access to the <code class="docutils literal"><span class="pre">glance</span></code> database. Replace <code class="docutils literal"><span class="pre">GLANCE_DBPASS</span></code>
with a suitable password.:</p>
<div class="highlight-python"><div class="highlight"><pre>GRANT ALL PRIVILEGES ON glance.* TO &#39;glance&#39;@&#39;localhost&#39; \
  IDENTIFIED BY &#39;GLANCE_DBPASS&#39;;
GRANT ALL PRIVILEGES ON glance.* TO &#39;glance&#39;@&#39;%&#39; \
  IDENTIFIED BY &#39;GLANCE_DBPASS&#39;;
</pre></div>
</div>
</li>
<li><p class="first">Exit the database access client.</p>
</li>
</ul>
</li>
<li><p class="first">Source the <code class="docutils literal"><span class="pre">admin</span></code> credentials to gain access to admin-only CLI commands.:</p>
<div class="highlight-python"><div class="highlight"><pre>$ source admin-openrc.sh
</pre></div>
</div>
</li>
<li><p class="first">To create the service credentials, complete these steps:</p>
<ul>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">glance</span></code> user:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack user create --domain default --password-prompt glance
User Password:
Repeat User Password:
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | default                          |
| enabled   | True                             |
| id        | e38230eeff474607805b596c91fa15d9 |
| name      | glance                           |
+-----------+----------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Add the <code class="docutils literal"><span class="pre">admin</span></code> role to the <code class="docutils literal"><span class="pre">glance</span></code> user and <code class="docutils literal"><span class="pre">service</span></code> project.:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack role add --project service --user glance admin
</pre></div>
</div>
</li>
<li><p class="first">Create the <code class="docutils literal"><span class="pre">glance</span></code> service entity.:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack service create --name glance \
  --description &quot;OpenStack Image service&quot; image
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Image service          |
| enabled     | True                             |
| id          | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| name        | glance                           |
| type        | image                            |
+-------------+----------------------------------+
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Create the Image service API endpoints.:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack endpoint create --region RegionOne \
  image public http://controller:9292
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 340be3625e9b4239a6415d034e98aace |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  image internal http://controller:9292
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | a6e4b153c2ae4c919eccfdbb7dceb5d2 |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+

$ openstack endpoint create --region RegionOne \
  image admin http://controller:9292
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 0c37ed58103f4300a84ff125a539032d |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 8c2c7f1b9b5049ea9e63757b5533e6d2 |
| service_name | glance                           |
| service_type | image                            |
| url          | http://controller:9292           |
+--------------+----------------------------------+
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="install-and-configure-components">
<h2>Install and configure components<a class="headerlink" href="#install-and-configure-components" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Install OpenStack Image bundle.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># swupd bundle-add openstack-image</span>
<span class="c"># swupd verify --fix</span>
</pre></div>
</div>
</li>
<li><p class="first">Configurations will be located at <code class="docutils literal"><span class="pre">/etc/glance</span></code>.</p>
<ul>
<li><p class="first">Create <code class="docutils literal"><span class="pre">/etc/glance</span></code> directory.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># mkdir /etc/glance</span>
</pre></div>
</div>
</li>
<li><p class="first">Create <code class="docutils literal"><span class="pre">/etc/glance/glance-api.conf</span></code> and
<code class="docutils literal"><span class="pre">/etc/glance/glance-registry.conf</span></code> configuration files.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># touch /etc/glance/glance-{api,registry}.conf</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Edit the <code class="docutils literal"><span class="pre">/etc/glance/glance-api.conf</span></code> file and complete the following
actions:</p>
<ul>
<li><p class="first">In the <code class="docutils literal"><span class="pre">[database]</span></code> section, configure database access. Replace
<code class="docutils literal"><span class="pre">GLANCE_DBPASS</span></code> with the password you chose for the Image service
database.:</p>
<div class="highlight-python"><div class="highlight"><pre>[database]
...
connection = mysql://glance:GLANCE_DBPASS@controller/glance
</pre></div>
</div>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">[keystone_authtoken]</span></code> section, configure Identity service access.
Replace <code class="docutils literal"><span class="pre">GLANCE_PASS</span></code> with the password you chose for the <code class="docutils literal"><span class="pre">glance</span></code> user
in the Identity service.:</p>
<div class="highlight-python"><div class="highlight"><pre>[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
auth_plugin = password
project_domain_id = default
user_domain_id = default
project_name = service
username = glance
password = GLANCE_PASS
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Edit the <code class="docutils literal"><span class="pre">/etc/glance/glance-registry.conf</span></code> file and complete the following
actions:</p>
<ul>
<li><p class="first">In the <code class="docutils literal"><span class="pre">[database]</span></code> section, configure database access. Replace
<code class="docutils literal"><span class="pre">GLANCE_DBPASS</span></code> with the password you chose for the Image service
database.:</p>
<div class="highlight-python"><div class="highlight"><pre>[database]
...
connection = mysql://glance:GLANCE_DBPASS@controller/glance
</pre></div>
</div>
</li>
<li><p class="first">In the <code class="docutils literal"><span class="pre">[keystone_authtoken]</span></code> section, configure Identity service
access. Replace <code class="docutils literal"><span class="pre">GLANCE_PASS</span></code> with the password you chose for the
<code class="docutils literal"><span class="pre">glance</span></code> user in the Identity service.:</p>
<div class="highlight-python"><div class="highlight"><pre>[keystone_authtoken]
...
auth_uri = http://controller:5000
auth_url = http://controller:35357
auth_plugin = password
project_domain_id = default
user_domain_id = default
project_name = service
username = glance
password = GLANCE_PASS
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Ensure files have proper ownership by running the following command:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># systemctl restart update-triggers.target</span>
</pre></div>
</div>
</li>
<li><p class="first">Populate the Image Service database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="finalize-installation">
<h2>Finalize installation<a class="headerlink" href="#finalize-installation" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Start the Image Service services and configure them to start when the
system boots:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># systemctl enable glance-api.service glance-registry.service</span>
<span class="c"># systemctl start glance-api.service glance-registry.service</span>
</pre></div>
</div>
</li>
</ol>
<div class="section" id="verify-operation">
<h3>Verify operation<a class="headerlink" href="#verify-operation" title="Permalink to this headline">¶</a></h3>
<p>Verify operation of the Image service using
<a class="reference external" href="http://launchpad.net/cirros">CirrOS</a>, a small
Linux image that helps you test your OpenStack deployment.</p>
<ol class="arabic">
<li><p class="first">In each client environment script, configure the Image service
client to use API version 2.0:</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo &quot;export OS_IMAGE_API_VERSION=2&quot; \
  | tee -a admin-openrc.sh demo-openrc.sh
</pre></div>
</div>
</li>
<li><p class="first">Source the <code class="docutils literal"><span class="pre">admin</span></code> credentials to gain access to admin-only CLI commands:</p>
<div class="highlight-python"><div class="highlight"><pre>$ source admin-openrc.sh
</pre></div>
</div>
</li>
<li><p class="first">Download the source image:</p>
<div class="highlight-python"><div class="highlight"><pre>$ curl -Ok http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img
</pre></div>
</div>
</li>
<li><p class="first">Upload the image to the Image service using the <cite>QCOW2</cite> disk format, <cite>bare</cite>
container format, and public visibility so all projects can access it:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack image create cirros --file cirros-0.3.4-x86_64-disk.img \
  --disk-format qcow2 --container-format bare --public
+------------------+------------------------------------------------------+
| Field            | Value                                                |
+------------------+------------------------------------------------------+
| checksum         | ee1eca47dc88f4879d8a229cc70a07c6                     |
| container_format | bare                                                 |
| created_at       | 2015-10-26T23:40:03Z                                 |
| disk_format      | qcow2                                                |
| file             | /v2/images/fcf6fa55-56e9-4402-8137-3e9315c84905/file |
| id               | fcf6fa55-56e9-4402-8137-3e9315c84905                 |
| min_disk         | 0                                                    |
| min_ram          | 0                                                    |
| name             | cirros                                               |
| owner            | 2e3093872ebf4143a122e2cc01a50d13                     |
| protected        | False                                                |
| schema           | /v2/schemas/image                                    |
| size             | 13287936                                             |
| status           | active                                               |
| tags             |                                                      |
| updated_at       | 2015-10-26T23:40:03Z                                 |
| virtual_size     | None                                                 |
| visibility       | public                                               |
+------------------+------------------------------------------------------+
</pre></div>
</div>
</li>
<li><p class="first">Confirm upload of the image and validate attributes:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openstack image list
+--------------------------------------+--------+
| ID                                   | Name   |
+--------------------------------------+--------+
| 38047887-61a7-41ea-9b49-27987d5e8bb9 | cirros |
+--------------------------------------+--------+
</pre></div>
</div>
</li>
</ol>
<p>Next topic: <a class="reference internal" href="openstack_compute.html#openstack-compute"><span>Compute</span></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Image Service</a><ul>
<li><a class="reference internal" href="#install-and-configure-the-image-service">Install and configure the Image Service</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li><a class="reference internal" href="#install-and-configure-components">Install and configure components</a></li>
<li><a class="reference internal" href="#finalize-installation">Finalize installation</a><ul>
<li><a class="reference internal" href="#verify-operation">Verify operation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/openstack_image.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Intel OTC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/openstack_image.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>